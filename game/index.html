<script>
const cv = document.getElementById('cv'),
      ctx = cv.getContext('2d', { alpha: false });

function fit() {
  const dpr = Math.max(1, devicePixelRatio || 1);
  cv.width = innerWidth * dpr;
  cv.height = innerHeight * dpr;
  cv.style.width = innerWidth + 'px';
  cv.style.height = innerHeight + 'px';
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}
addEventListener('resize', fit);
fit();

// Load the sprite images
const maleImg = new Image();
maleImg.src = 'male yogi.png';

const femaleImg = new Image();
femaleImg.src = 'female yogi.png';

// Starfield code stays the same
const R = () => Math.random();
const stars = [...Array(260)].map(() => ({ x: R(), y: R(), s: R() * 1.4 + .4, c: R() < .08 ? '#9cf' : '#556b8b' }));
function drawStars(dt) {
  ctx.fillStyle = '#000';
  ctx.fillRect(0, 0, innerWidth, innerHeight);
  for (const t of stars) {
    ctx.fillStyle = t.c;
    ctx.fillRect(t.x * innerWidth, t.y * innerHeight, t.s, t.s);
    t.y = (t.y + dt * .02) % 1;
  }
}

// Draw yogi from PNG
function drawYogi(x, y, scale, sex) {
  const img = sex === 'm' ? maleImg : femaleImg;
  const w = img.width * scale;
  const h = img.height * scale;
  ctx.drawImage(img, x - w / 2, y - h / 2, w, h);
}

// Game loop stays the same, except drawYogi call
const yogis = [...Array(5)].map(() => ({
  x: 120 + R() * (innerWidth - 240),
  y: -100 - R() * 240,
  v: 120 + R() * 80,
  sex: R() < .5 ? 'm' : 'f'
}));
const bullets = [];
const ship = { x: innerWidth / 2, y: innerHeight - 90 };
let left = false, right = false, shoot = false, score = 0, level = 1;

addEventListener('keydown', e => {
  const k = e.key.toLowerCase();
  if (k === 'arrowleft' || k === 'a') left = true;
  if (k === 'arrowright' || k === 'd') right = true;
  if (k === ' ') shoot = true;
});
addEventListener('keyup', e => {
  const k = e.key.toLowerCase();
  if (k === 'arrowleft' || k === 'a') left = false;
  if (k === 'arrowright' || k === 'd') right = false;
  if (k === ' ') shoot = false;
});

let last = performance.now();
function loop(t) {
  const dt = (t - last) / 1000;
  last = t;
  update(dt);
  render(dt);
  requestAnimationFrame(loop);
}
function update(dt) {
  const s = 480;
  ship.x = Math.max(30, Math.min(innerWidth - 30, ship.x + ((right ? 1 : 0) - (left ? 1 : 0)) * s * dt));
  if (shoot && (!bullets.length || performance.now() - bullets.at(-1).t > 120)) {
    bullets.push({ x: ship.x, y: ship.y - 14, v: 900, t: performance.now() });
  }
  for (const b of bullets) b.y -= b.v * dt;
  while (bullets.length && bullets[0].y < -20) bullets.shift();

  for (const y of yogis) {
    y.y += y.v * dt;
    if (y.y > innerHeight + 80) {
      y.x = 120 + R() * (innerWidth - 240);
      y.y = -100 - R() * 240;
      y.v = 120 + R() * 80;
    }
  }
  for (const b of bullets) {
    for (const y of yogis) {
      const w = 70, h = 88;
      if (b.x > y.x - w / 2 && b.x < y.x + w / 2 && b.y > y.y - h / 2 && b.y < y.y + h / 2) {
        score += 10;
        y.x = 120 + R() * (innerWidth - 240);
        y.y = -100 - R() * 240;
        y.v = 120 + R() * 80;
        b.y = -9999;
      }
    }
  }
  document.getElementById('hud').textContent = `SCORE ${String(score).padStart(4, '0')}   LEVEL ${level}`;
}
function render(dt) {
  drawStars(dt);
  for (const y of yogis) drawYogi(y.x, y.y, 0.5, y.sex);
  ctx.fillStyle = '#ffe08a'; for (const b of bullets) ctx.fillRect(b.x - 1, b.y - 12, 2, 20);
  ctx.fillStyle = '#3fd092'; ctx.fillRect(ship.x - 6, ship.y - 20, 12, 20);
  ctx.fillStyle = '#2aa579'; ctx.fillRect(ship.x - 14, ship.y - 10, 28, 10);
  ctx.fillStyle = '#1b6e53'; ctx.fillRect(ship.x - 22, ship.y - 5, 44, 5);
}
requestAnimationFrame(loop);
</script>
